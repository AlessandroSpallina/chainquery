
# LBRY Chain Query

![Code Climate](https://img.shields.io/codeclimate/tech-debt/lbryio/chainquery.svg)

[![Go Report Card](https://goreportcard.com/badge/github.com/lbryio/chainquery)](https://goreportcard.com/report/github.com/lbryio/chainquery)

[![Maintainability](https://api.codeclimate.com/v1/badges/3f60ac6b2d7e96f93992/maintainability)](https://codeclimate.com/github/lbryio/chainquery/maintainability)

![GitHub release](https://img.shields.io/github/release/lbryio/chainquery.svg)

![Github commits (since latest release)](https://img.shields.io/github/commits-since/lbryio/chainquery/latest.svg)


## Active Development Notice
 
The project is under active development so sql migrations are not being used yet. All changes to the schema are being added to the initial schema since there are so many changes currently. Please be sure to drop all tables before starting the app to ensure that you will have the latest schema if this is not the first time using the application.

## Prerequisites

### OS Specifics

#### OSX

- In order to use  `wget` you will need `brew install wget` (used in [build.sh](build.sh))
- Chainquery is built for Linux by default in  [build.sh](build.sh), so you will need to modify the cross compilation for an OSX build.


### Go

Make sure you have Go 1.9+

- Ubuntu: https://launchpad.net/~longsleep/+archive/ubuntu/golang-backports or https://github.com/golang/go/wiki/Ubuntu
- OSX: `brew install go`

### MySQL

- Install and run mysql.(OSX: `brew install mysql`)
- Create `chainquery` database.
- Create user `lbry` with password `lbry` and grant it all permissions on `chainquery` db.

### Lbrycrd


- Install lbrycrdd (https://github.com/lbryio/lbrycrd/releases)
- Ensure `~/.lbrycrd/lbrycrd.conf` file exists with username and password.
  If you don't have one, run:

  ```
  mkdir -p ~/.lbrycrd
  echo -e "rpcuser=lbryrpc\nrpcpassword=$(env LC_CTYPE=C LC_ALL=C tr -dc A-Za-z0-9 < /dev/urandom | head -c 16 | xargs)" > ~/.lbrycrd/lbrycrd.conf
  ```

- Run `./lbrycrdd -server -daemon -txindex -conf=$HOME/.lbrycrd/lbrycrd.conf`. If you get an error about indexing, add the `-reindex` flag for one run. You will only need to
  reindex once.

##Configuration

Chainquery can be[configured](/config/default/chainqueryconfig.toml)via toml file.

## Running from Source

```
go get -u github.com/lbryio/chainquery
cd "$(go env GOPATH)/src/github.com/lbryio/chainquery"
./dev.sh
```

## Contributing

Contributions to this project are welcome, encouraged, and compensated. For more details, see [lbry.io/faq/contributing](https://lbry.io/faq/contributing)

The `master` branch is regularly built and tested, but is not guaranteed to be
completely stable. [Releases](https://github.com/lbryio/chainquery/releases) are created
regularly to indicate new official, stable release versions.

Developers are strongly encouraged to write unit tests for new code, and to
submit new unit tests for old code. Unit tests can be compiled and run
 with: `go test ./...` from the source directory which should be `$GOPATH/github.com/lbryio/chainquery`.

## Updating the generated models

We use [sqlboiler](https://github.com/lbryio/sqlboiler) to generate our data models based on the db schema. If you make  schema changes, run `./gen_models.sh` to
regenerate the models.

**A note of caution:** the models are generated by connecting to the MySQL server and inspecting the current schema. If you made any db schema changes by hand, then the
schema may be out of sync with the migrations. Here's the safe way to ensure that the models match the migrations:

- Put all the schema changes you want to make into a migration.
- In mysql, drop and recreate the db you're using, so that it's empty.
- Run `./dev.sh`. This will run all the migrations on the empty db.
- Run `./gen_models.sh` to update the models.

This process ensures that the generated models will match the updated schema exactly, so there are no surprises when the migrations are applied to the live db.

## License

This project is MIT licensed. For the full license, see [LICENSE](LICENSE).

## Security

We take security seriously. Please contact security@lbry.io regarding any security issues.
Our PGP key is [here](https://keybase.io/lbry/key.asc) if you need it.

## Contact

The primary contact for this project is [@tiger5226](https://github.com/tiger5226)
